# 阿里云 Serverless 应用平台 (CAP) 部署配置
# 使用容器镜像部署 Next.js 应用

edition: 3.0.0
name: imageai-app
access: default

vars:
  region: cn-hangzhou

resources:
  imageai_function:
    component: fc3
    props:
      region: ${vars.region}
      functionName: imageai-function
      description: ImageAI Next.js 函数
      # 使用容器镜像部署
      runtime: custom-container
      cpu: 1
      memorySize: 2048
      diskSize: 512
      timeout: 120
      instanceConcurrency: 100
      # 容器镜像配置 - 使用 Docker Hub 公共镜像
      customContainerConfig:
        image: ylyuanlu/imageai:latest
        port: 3000
      # 环境变量
      environmentVariables:
        NODE_ENV: production
        DATABASE_URL: postgresql://neondb_owner:npg_cip6ngWvR1qE@ep-raspy-bread-a1q9uuho-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require
        JWT_SECRET: ftSN3SXO1yAIklAVKOA13gY6gP/54JfJ0JDoT4hKGY8=
        JWT_EXPIRES_IN: "7d"
        TONGYI_API_KEY: sk-777a9155d80a4703aa169c7f41947dcd
        NEXT_PUBLIC_APP_URL: https://imageai-function-cn-hangzhou.fcapp.run
        NEXT_PUBLIC_APP_NAME: ImageAI
        RESEND_API_KEY: re_FFXsxDYW_JucqzmiLMP1osaxUsbCBy9Gs
        FROM_EMAIL: onboarding@resend.dev
        FROM_NAME: ImageAI
        ENABLE_REGISTRATION: "true"
        ENABLE_PAYMENT: "false"
      # 触发器
      triggers:
        - triggerName: httpTrigger
          triggerType: http
          triggerConfig:
            authType: anonymous
            methods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
